# üìä –ê–Ω–∞–ª–∏–∑ –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö, –í–æ—Ä–∫–µ—Ä–∞ –∏ S3 –•—Ä–∞–Ω–∏–ª–∏—â–∞

## –î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞
16 –¥–µ–∫–∞–±—Ä—è 2025

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### üóÑÔ∏è –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö (PostgreSQL)

#### –î–∞–Ω–Ω—ã–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:
| –¢–∞–±–ª–∏—Ü–∞ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-------------------|----------|
| `Client` | 5 | –ö–ª–∏–µ–Ω—Ç—ã |
| `Meeting` | 20 | –í—Å—Ç—Ä–µ—á–∏ |
| `MeetingParticipant` | 0 | –£—á–∞—Å—Ç–Ω–∏–∫–∏ –≤—Å—Ç—Ä–µ—á |
| `MeetingViewer` | 0 | –ù–∞–±–ª—é–¥–∞—Ç–µ–ª–∏ –≤—Å—Ç—Ä–µ—á |
| `UploadBlob` | 6 | –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ |
| `Transcript` | 12 | –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç—ã –≤—Å—Ç—Ä–µ—á |
| `Artifacts` | 12 | –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã (—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã LLM) |
| `Validation` | 8 | –í–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Å—Ç—Ä–µ—á |
| `ProcessingError` | 3 | –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ |
| `LLMInteraction` | 29 | –ò—Å—Ç–æ—Ä–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π —Å LLM |

**–ò—Ç–æ–≥–æ –∑–∞–ø–∏—Å–µ–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:** 95

#### –î–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:
| –¢–∞–±–ª–∏—Ü–∞ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-------------------|----------|
| `User` | 3 | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã |
| `MeetingType` | 1 | –¢–∏–ø—ã –≤—Å—Ç—Ä–µ—á |
| `PromptScenario` | 3 | –°—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ |
| `DirectoryParticipant` | 0 | –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ |

**–ò—Ç–æ–≥–æ –∑–∞–ø–∏—Å–µ–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:** 7

### üìÅ S3/MinIO –•—Ä–∞–Ω–∏–ª–∏—â–µ

- **–§–∞–π–ª–æ–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:** 6
- **–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä:** 1.28 GB
- **–ü—É—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è:** `meetings/{meetingId}/{timestamp}_{filename}`

### üî¥ Redis/BullMQ –í–æ—Ä–∫–µ—Ä

| –¢–∏–ø | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|-----------|----------|
| Completed jobs | 16 | –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ |
| Failed jobs | 0 | –ü—Ä–æ–≤–∞–ª–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ |
| Active jobs | 0 | –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ |
| Waiting jobs | 1 | –û–∂–∏–¥–∞—é—â–∏–µ –∑–∞–¥–∞—á–∏ |
| Delayed jobs | 0 | –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ |
| Meeting locks | 0 | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤—Å—Ç—Ä–µ—á |

**–ò—Ç–æ–≥–æ –∑–∞–¥–∞—á:** 17

---

## –°—Ö–µ–º–∞ —Å–≤—è–∑–µ–π –ë–î

```
Client (5)
  ‚îî‚îÄ> Meeting (20)
       ‚îú‚îÄ> MeetingParticipant (0)
       ‚îú‚îÄ> MeetingViewer (0)
       ‚îú‚îÄ> UploadBlob (6) ‚Üí S3 Files (6 files, 1.28 GB)
       ‚îú‚îÄ> Transcript (12)
       ‚îú‚îÄ> Artifacts (12)
       ‚îú‚îÄ> Validation (8)
       ‚îú‚îÄ> ProcessingError (3)
       ‚îî‚îÄ> LLMInteraction (29)
```

## Cascade Delete

–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ `Meeting` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è:
- ‚úÖ `MeetingParticipant` (onDelete: Cascade)
- ‚úÖ `MeetingViewer` (onDelete: Cascade)
- ‚úÖ `UploadBlob` (onDelete: Cascade)
- ‚úÖ `Transcript` (onDelete: Cascade)
- ‚úÖ `Artifacts` (onDelete: Cascade)
- ‚úÖ `Validation` (onDelete: Cascade)
- ‚úÖ `ProcessingError` (onDelete: Cascade)
- ‚úÖ `LLMInteraction` (onDelete: Cascade)

**–í–∞–∂–Ω–æ:** –§–∞–π–ª—ã –≤ S3 –ù–ï —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, —Ç—Ä–µ–±—É–µ—Ç—Å—è —è–≤–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ!

---

## –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç: `scripts/full-system-cleanup.ts`

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç–∞:

1. **–ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã** (–ë–î + S3 + Redis)
2. **–û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞** (—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º Redis)
3. **Dry-run —Ä–µ–∂–∏–º** (–ø–æ–∫–∞–∑–∞—Ç—å –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è)
4. **–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** –¥–æ –∏ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏
5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏** –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä —á—Ç–æ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
npx tsx scripts/full-system-cleanup.ts --dry-run

# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
npx tsx scripts/full-system-cleanup.ts --confirm

# –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
npx tsx scripts/full-system-cleanup.ts --client cli1 --confirm

# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º —Å –∑–∞–ø—Ä–æ—Å–æ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
npx tsx scripts/full-system-cleanup.ts
```

---

## –ü—Ä–æ—Ü–µ—Å—Å –æ—á–∏—Å—Ç–∫–∏

### –†–µ–∂–∏–º: --all (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

1. ‚úÖ –û—á–∏—Å—Ç–∏—Ç—å Redis –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (`lock:meeting:*`)
2. ‚úÖ –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏ –∏–∑ BullMQ –æ—á–µ—Ä–µ–¥–∏
3. ‚úÖ –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª—ã –∏–∑ S3/MinIO
4. ‚úÖ –£–¥–∞–ª–∏—Ç—å –≤—Å—Ç—Ä–µ—á–∏ –∏–∑ –ë–î (–∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)
5. ‚úÖ –£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ –ë–î
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å
7. ‚úÖ –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

### –†–µ–∂–∏–º: --client <id>

1. ‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –æ—á–∏—Å—Ç–∫—É Redis (–º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–¥–∞—á–∏ –¥—Ä—É–≥–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤)
2. ‚úÖ –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ S3
3. ‚úÖ –£–¥–∞–ª–∏—Ç—å –≤—Å—Ç—Ä–µ—á–∏ –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ –ë–î
4. ‚úÖ –£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ –ë–î
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å
6. ‚úÖ –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞:

```bash
# –®–∞–≥ 1: –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ
npx tsx scripts/full-system-cleanup.ts --dry-run

# –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å backup –ë–î (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
pg_dump aam_db > backup_$(date +%Y%m%d_%H%M%S).sql

# –®–∞–≥ 3: –í—ã–ø–æ–ª–Ω–∏—Ç—å –æ—á–∏—Å—Ç–∫—É
npx tsx scripts/full-system-cleanup.ts --confirm
```

### ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:

1. **–£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ** - –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑ backup
2. **–§–∞–π–ª—ã –≤ S3** —É–¥–∞–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–∫—Ä–∏–ø—Ç–æ–º, –Ω–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. **Redis –∑–∞–¥–∞—á–∏** –æ—á–∏—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `--all` —Ä–µ–∂–∏–º–µ
4. **Cascade delete** —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –ë–î, –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç S3

---

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –±–æ–ª–µ–µ —Ç–æ—á–µ—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞:

| –°–∫—Ä–∏–ø—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –û—á–∏—â–∞–µ—Ç |
|--------|----------|---------|
| `full-system-cleanup.ts` | –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã | –ë–î + S3 + Redis |
| `clean-database.ts` | –û—á–∏—Å—Ç–∫–∞ –ë–î –∏ S3 | –ë–î + S3 |
| `cleanup-meetings.ts` | –¢–æ–ª—å–∫–æ –ë–î –±–µ–∑ S3 | –ë–î |
| `delete-meeting.ts <id>` | –û–¥–Ω–∞ –≤—Å—Ç—Ä–µ—á–∞ | –ë–î + S3 (–æ–¥–Ω–∞ –≤—Å—Ç—Ä–µ—á–∞) |
| `cleanup-old-jobs.ts` | –°—Ç–∞—Ä—ã–µ –∑–∞–¥–∞—á–∏ Redis | Redis (—Å—Ç–∞—Ä—ã–µ –∑–∞–¥–∞—á–∏) |

---

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ (–æ–∂–∏–¥–∞–µ–º–∞—è)

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `full-system-cleanup.ts --confirm`:

### –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö:
- Clients: 0
- Meetings: 0
- –í—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏: 0

### S3 Storage:
- –§–∞–π–ª–æ–≤: 0
- –†–∞–∑–º–µ—Ä: 0 Bytes

### Redis:
- –ó–∞–¥–∞—á–∏: 0
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏: 0

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ:
- Users: 3
- MeetingTypes: 1
- PromptScenarios: 3
- DirectoryParticipants: 0

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs -f worker`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL, Redis, MinIO
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--dry-run` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
4. –°–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é: `CLEANUP_GUIDE.md`

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 16 –¥–µ–∫–∞–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°–∫—Ä–∏–ø—Ç:** `scripts/full-system-cleanup.ts`

