
  

**Проект:** Внутреннее веб-приложение обработки видео-встреч (STT + LLM) "Assist after meeting(AAM)"

**Заказчик:** внутренняя команда внедрения/пресейл (Bitrix24 интегратор)

**Дата:** 07.12.2025

**Статус:** утверждено для разработки v1.0

---

## **1. Цель и бизнес-результат**

  

### **1.1 Цель**

  

Автоматизировать обработку видеозаписей пресейл-встреч, чтобы получить структурированные артефакты для дальнейшей работы (КП, уточнения требований, фиксация договорённостей), снизить потери информации и “человеческий фактор памяти”.

  

### **1.2 Ожидаемый эффект**

- Повышение полноты и точности КП и последующих действий.
    
- Снижение количества возвратов КП аналитиком на доработку (за счёт более полной фиксации требований/болей).
    
- Повышение управляемости пресейл-коммуникации (единый контекст клиента).
    

---

## **2. Термины**

- **User** — сотрудник компании, использующий сервис (загрузка, просмотр, валидация).
    
- **Admin** — пользователь с расширенными правами управления (пользователи, сценарии, справочники, системные настройки).
    
- **Встреча (Meeting)** — сущность обработки одной записи.
    
- **Клиент (Client)** — карточка клиента с историей встреч и контекстом.
    
- **Тип встречи (Meeting Type)** — классификация: Первая / Повторная / Презентация КП.
    
- **Сценарий (Prompt Scenario)** — настраиваемый профиль промтов и выходных артефактов для конкретного типа встречи.
    
- **Артефакты** — результаты обработки (транскрипт, резюме и др.).
    
- **Контекст клиента (Client Context Summary)** — единый накопительный Markdown-документ по клиенту.
    

---

## **3. Объём работ v1.0**

  

### **3.1 Входит (In-scope)**

1. Логин/пароль.
    
2. Создание встречи через форму + загрузка записи (видео/аудио).
    
3. STT: Deepgram Pre-recorded (Nova-3 + diarization + keyterm).
    
4. LLM: OpenAI API GPT-5.1.
    
5. Генерация артефактов по выбранному сценарию (строгий JSON-ответ).
    
6. Валидация (Accept/Reject) без ручного редактирования текста.
    
7. Автоудаление исходного файла записи:
    
    - после успешной генерации всех артефактов;
        
    - при ошибке — через TTL 24 часа.
        
    
8. Клиентская база + история встреч.
    
9. Накопительный контекст клиента (MD), обновляемый после Accept.
    
10. Справочник участников (внутренние/внешние).
    
11. Шаринг и передача владения встречей (минимальная модель доступа).
    
12. Админка сценариев (редактирование промтов, схем, набора артефактов).
    

  

### **3.2 Не входит (Out-of-scope), но учитывается для расширений**

- Генерация КП в docx/pdf.
    
- Интеграция с Bitrix24.
    
- Автоопределение типа встречи.
    
- Повторная обработка (Re-run).
    
- Аудит логов доступа (кто смотрел/копировал) — не требуется.
    

---

## **4. Нагрузочные вводные**

- 12 встреч/день, 5 дней/неделя.
    
- Средняя длительность: 1ч 15м.
    
- Максимальный размер файла: до 1.2 GB.
    

---

## **5. Роли и права доступа**

  

### **5.1 Роли**

- **User** — рабочий пользователь.
    
- **Admin** — управление системой.
    

  

### **5.2 Доступ к встречам (v1.0)**

  

У встречи есть:

- **owner** — ответственный User.
    
- **viewers** — пользователи с доступом “просмотр”.
    

  

Правила:

- Просматривать результаты может: **owner + viewers + Admin (support)**.
    
- Валидировать (Accept/Reject) может: **только owner**.
    
- Управлять доступом (Share/Revoke/Transfer) может: **только owner**.
    
- Admin по умолчанию имеет read-only “support access” (настраиваемо).
    

---

## **6. Основные сценарии использования**

1. User создаёт Meeting: выбирает Client, Meeting Type, Scenario, участников, загружает запись.
    
2. Система запускает pipeline: STT → LLM → сохранение артефактов → удаление файла.
    
3. User открывает Meeting, копирует нужные артефакты, нажимает Accept/Reject.
    
4. При Accept система обновляет Client Context Summary (MD).
    
5. Owner может поделиться результатами (add viewers) или передать владение.
    
6. Admin редактирует сценарии, схему артефактов и типы встреч.
    

---

## **7. Функциональные требования**

  

### **7.1 Аутентификация**

- Логин: email + пароль.
    
- Пароли хранить только в виде hash (argon2/bcrypt).
    
- Сессии: secure httpOnly cookies (рекомендуемо).
    
- Функции Admin:
    
    - создание/блокировка пользователей,
        
    - сброс пароля (механизм TBD внутри команды; допустимо через admin UI).
        
    

  

### **7.2 Справочник клиентов (Client)**

- Создание клиента: name (обязательное), доп.поля опционально.
    
- Страница клиента:
    
    - список встреч (дата/тип/статус/owner),
        
    - Client Context Summary (MD) + кнопка Copy,
        
    - создание новой встречи по этому клиенту.
        
    

  

### **7.3 Справочник участников (Directory)**

  

Участник:

- type: internal / external
    
- full_name (обязательно)
    
- role_title (опционально)
    
- company_name (для external, опционально)
    
- department (для internal, опционально)
    
- tags (опционально)
    

  

Функции:

- поиск/фильтр,
    
- создание/редактирование/деактивация.
    
    Права:
    
- по умолчанию управление справочником: Admin (в v1.1 можно расширить на owner).
    

  

### **7.4 Создание встречи (форма)**

  

Поля формы:

- Client (выбор/создание)
    
- Meeting Type (Первая/Повторная/Презентация КП)
    
- Scenario (по умолчанию активный для типа, можно выбрать другой активный)
    
- Participants (multi-select из Directory)
    
- Title (опционально)
    
- Upload file (видео/аудио)
    

  

После отправки:

- создаётся Meeting со статусом Uploaded,
    
- создаётся UploadBlob со временем жизни,
    
- ставится job в очередь.
    

  

### **7.5 Поддерживаемые форматы файлов**

- Любые форматы, поддерживаемые Deepgram Pre-recorded.
    
- Ограничение размера: ≤ 1.2 GB.
    
- При загрузке валидировать mime/расширение и размер.
    

  

### **7.6 Pipeline обработки (оркестрация)**

  

Статусы Meeting:

- Uploaded
    
- Transcribing
    
- LLM_Processing
    
- Ready
    
- Validated
    
- Rejected
    
- Failed_Transcription
    
- Failed_LLM
    
- Failed_System
    

  

Этапы:

1. **Transcribing**
    
    - Deepgram Pre-recorded: Nova-3 + diarization + keyterm
        
    - Результат нормализуется в структуру Transcript (segments + keyterms).
        
    
2. **LLM_Processing**
    
    - Вход LLM:
        
        - Transcript (segments + общий текст)
            
        - метаданные встречи: client, meeting_type, scenario, participants
            
        - текущий Client Context Summary (MD)
            
        
    - Выход LLM: строго JSON по output_schema сценария.
        
    
3. Сохранение Artifacts.
    
4. Статус Ready.
    
5. Удаление UploadBlob (успех).
    
6. При ошибках:
    
    - выставить статус ошибки,
        
    - файл удалить по TTL 24 часа.
        
    

  

Требование: pipeline асинхронный, UI показывает статус.

  

### **7.7 Артефакты (v1.0)**

  

**Общее правило:** состав артефактов задаётся сценариями.

  

Минимальная конфигурация:

- **Первая встреча**: A1, A2, A3, A4
    
- **Презентация КП**: A1, A3, A4
    
- **Повторная встреча**: configurable (настраивается сценарием; допускаем изменения в ходе разработки без изменения кода)
    

  

Где:

- A1 — транскрипт со спикерами и таймкодами
    
- A2 — требования и боли
    
- A3 — внутреннее резюме
    
- A4 — внешнее резюме
    

  

UI должен отображать артефакты в человекочитаемом виде и давать кнопку Copy.

  

### **7.8 Валидация**

- Только owner может нажать Accept/Reject.
    
- Accept:
    
    - статус → Validated,
        
    - запускается job обновления Client Context Summary (MD).
        
    
- Reject:
    
    - статус → Rejected,
        
    - Client Context Summary не обновляется.
        
    

  

### **7.9 Контекст клиента (Client Context Summary, MD)**

- Хранится в Client как client_context_summary_md.
    
- Обновляется только после Accept:
    
    - вход: предыдущий summary + артефакты текущей встречи,
        
    - выход: новый summary (MD).
        
    
- Отдельной страницы “истории версий” нет (храним только актуальную версию).
    

  

### **7.10 Шаринг/передача встречи**

  

Owner может:

- добавить viewer,
    
- удалить viewer,
    
- передать ownership другому User.
    
    Правило: валидирует всегда только текущий owner.
    

  

### **7.11 Управление сценариями (Admin)**

  

Admin UI:

- создание/редактирование Meeting Types
    
- создание/редактирование Scenarios:
    
    - system_prompt
        
    - artifacts_config (список артефактов + отображаемые названия)
        
    - output_schema (JSON schema)
        
    - активность сценария
        
    
- назначение “сценарий по умолчанию” для типа встречи
    

---

## **8. Требования к формату ответов LLM**

  

### **8.1 Обязательное**

  

LLM должен возвращать JSON, валидируемый по schema сценария.

  

### **8.2 Минимальная единая структура (рекомендуемая)**

  

У каждого сценария должна быть единая “обёртка”, чтобы UI был универсальным:

```
{
  "artifacts": {
    "A1_transcript": { "content_md": "...", "segments": [] },
    "A2_requirements_pains": { "content_md": "..." },
    "A3_internal_summary": { "content_md": "..." },
    "A4_external_summary": { "content_md": "..." }
  },
  "quality": {
    "missing_info_questions": [],
    "notes": []
  }
}
```

Сценарий может отключать A2/A4 и т.п., но структура artifacts сохраняется.

---

## **9. Требования к хранению и удалению**

- UploadBlob (исходная запись):
    
    - хранить только временно,
        
    - удалить сразу после успешного формирования артефактов,
        
    - при ошибке удалить через 24 часа (TTL).
        
    
- Transcript + Artifacts + Client Context Summary:
    
    - хранить бессрочно.
        
    
- Логи доступа: не требуются.
    

---

## **10. Нефункциональные требования**

- Безопасность: TLS, секреты API в защищённом хранилище (env + vault/secret manager).
    
- Масштабируемость: отдельные воркеры для обработки очереди.
    
- Надёжность: ретраи запросов к внешним API (Deepgram/OpenAI) с ограничением попыток.
    
- UX: статусы + сообщения об ошибке понятные пользователю.
    

---

## **11. Рекомендуемая архитектура и стек (v1.0)**

  

### **11.1 Стек (фиксируем как рекомендуемый)**

- Frontend/Backend: **Next.js (TypeScript)** (UI + API routes)
    
- DB: **PostgreSQL**
    
- Object Storage: **S3-compatible (MinIO)** для временных файлов
    
- Queue: **Redis + BullMQ**
    
- Deploy: Docker Compose (dev), далее staging/prod
    

  

### **11.2 Модули**

1. Auth Module
    
2. Client KB Module (Clients + Context Summary)
    
3. Directory Module (Participants)
    
4. Meeting Module
    
5. Upload Module (presigned uploads + TTL delete)
    
6. Deepgram Adapter
    
7. OpenAI Adapter
    
8. Scenario Module
    
9. Orchestrator/Jobs Module
    

---

## **12. UI/Экраны (минимум v1.0)**

1. Login
    
2. Dashboard (список “моих встреч” + статусы)
    
3. Clients list + Client detail
    
4. Create Meeting (форма + upload)
    
5. Meeting detail (артефакты + copy + Accept/Reject + Share/Transfer)
    
6. Directory (participants)
    
7. Admin: Users
    
8. Admin: Meeting Types & Scenarios
    

---

## **13. Критерии приёмки v1.0**

1. Пользователь создаёт встречу, загружает файл до 1.2GB, выбирает client/type/scenario/participants.
    
2. Pipeline проходит STT и LLM асинхронно, статусы корректно отображаются.
    
3. Deepgram выдаёт транскрипт с diarization и таймкодами; сохраняется нормализованно.
    
4. GPT-5.1 возвращает JSON, валидируемый по schema сценария; артефакты отображаются.
    
5. Кнопки Copy работают для каждого артефакта.
    
6. Исходный файл удаляется после успешной генерации артефактов; при ошибке — через 24h.
    
7. Accept обновляет Client Context Summary (MD). Reject не обновляет.
    
8. Доступы работают: owner/ viewer / Admin. Валидирует только owner.
    
9. Admin может создать/изменить сценарий и набор артефактов без изменения кода.
    

---

## **14. Бэклог расширений (v1.1/v2)**

- Re-run по кнопке (пересчитать по новому сценарию).
    
- Экспорт в docx/pdf (КП).
    
- Интеграция с Bitrix24 (комментарий в сделке, хранение ссылок).
    
- Автоматическое определение типа встречи.
    
- Версионирование Client Context Summary.
    
- Полнотекстовый поиск по артефактам.
    

---

Если хочешь, следующим сообщением я сделаю “приложения к ТЗ” (чтобы разработчикам было ещё легче):

1. **ER-диаграмму сущностей** (в текстовом виде)
    
2. **API эндпоинты** (список + DTO)
    
3. **черновые JSON-схемы** для 3 типов встреч и пример system_prompt для каждого сценария.